<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.20.1 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Exploratory Model Analysis on Heart Disease Data - Dossiers</title>
<meta name="description" content="Behind the scenes of the “max heart rate achieved” is good for heart.  This is for people who love programming.  Unlike the traditional style where we do EDA, we start with model building as shown below .  The sceptisism from traditional style programmers in ML is that the ensemble or deep learning models are not interpretable.  This post shows how to utilize the power of non-linearity and ensemble model (RandomForest) to study the relationship of heart disease (outcome) from the given data. Imports">


  <meta name="author" content="Giree">
  
  <meta property="article:author" content="Giree">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Dossiers">
<meta property="og:title" content="Exploratory Model Analysis on Heart Disease Data">
<meta property="og:url" content="http://localhost:4000/exploratory-model-analysis-on-heart-disease-data/">


  <meta property="og:description" content="Behind the scenes of the “max heart rate achieved” is good for heart.  This is for people who love programming.  Unlike the traditional style where we do EDA, we start with model building as shown below .  The sceptisism from traditional style programmers in ML is that the ensemble or deep learning models are not interpretable.  This post shows how to utilize the power of non-linearity and ensemble model (RandomForest) to study the relationship of heart disease (outcome) from the given data. Imports">





  <meta name="twitter:site" content="@sahyagiri">
  <meta name="twitter:title" content="Exploratory Model Analysis on Heart Disease Data">
  <meta name="twitter:description" content="Behind the scenes of the “max heart rate achieved” is good for heart.  This is for people who love programming.  Unlike the traditional style where we do EDA, we start with model building as shown below .  The sceptisism from traditional style programmers in ML is that the ensemble or deep learning models are not interpretable.  This post shows how to utilize the power of non-linearity and ensemble model (RandomForest) to study the relationship of heart disease (outcome) from the given data. Imports">
  <meta name="twitter:url" content="http://localhost:4000/exploratory-model-analysis-on-heart-disease-data/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2020-09-13T00:00:00+05:30">





  

  


<link rel="canonical" href="http://localhost:4000/exploratory-model-analysis-on-heart-disease-data/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Gireesan Namboothiri",
      "url": "http://localhost:4000/",
      "sameAs": ["https://www.linkedin.com/in/sahyagiri","https://twitter.com/sahyagiri","https://www.facebook.com/sahyagiri","https://instagram.com/sahyagiri","https://www.linkedin.com/in/sahyagiri"]
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Dossiers Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/assets/gdpr/style.css" />
<script src="/assets/gdpr/browser/bundle.js"></script>
<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Dossiers
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about">About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Giree</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Random thoughts scribed here.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Somewhere else</span>
        </li>
      

      
        
          
            <li><a href="mailto:giri@dossiers.page" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
        
          
        
          
        
          
        
          
            <li><a href="https://instagram.com/sahyagiri" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i><span class="label">Instagram</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/sahyagiri" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Exploratory Model Analysis on Heart Disease Data">
    <meta itemprop="description" content="Behind the scenes of the “max heart rate achieved” is good for heart.  This is for people who love programming. Unlike the traditional style where we do EDA, we start with model building as shown below .The sceptisism from traditional style programmers in ML is that the ensemble or deep learning models are not interpretable.  This post shows how to utilize the power of non-linearity and ensemble model (RandomForest) to study the relationship of heart disease (outcome) from the given data.Imports">
    <meta itemprop="datePublished" content="2020-09-13T00:00:00+05:30">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Exploratory Model Analysis on Heart Disease Data
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>Behind the scenes of the “max heart rate achieved” is good for heart.  This is for people who love programming. 
Unlike the traditional style where we do EDA, we start with model building as shown below .<br />
<img src="/assets/images/exploratory_model_analysis_flow.jpg" alt="exploratory model analysis steps" />
The sceptisism from traditional style programmers in ML is that the ensemble or deep learning models are not interpretable.  This post shows how to utilize the power of non-linearity and ensemble model (RandomForest) to study the relationship of heart disease (outcome) from the given data.</p>
<h2 id="imports">Imports</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="p">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s">'ignore'</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">eli5.sklearn</span> <span class="kn">import</span> <span class="n">PermutationImportance</span>

<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">shap</span>
<span class="kn">from</span> <span class="nn">pdpbox</span> <span class="kn">import</span> <span class="n">pdp</span><span class="p">,</span> <span class="n">info_plots</span>  <span class="c1"># for partial plots
</span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="n">sns</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

</code></pre></div></div>

<h2 id="utility-functions">Utility Functions</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_categorical_variables</span><span class="p">(</span><span class="n">data_frame</span><span class="p">,</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.70</span><span class="p">,</span> <span class="n">top_n_values</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">likely_categorical</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">data_frame</span><span class="p">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="mf">1.</span> <span class="o">*</span> <span class="n">data_frame</span><span class="p">[</span><span class="n">column</span><span class="p">].</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">head</span><span class="p">(</span><span class="n">top_n_values</span><span class="p">).</span><span class="nb">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="n">likely_categorical</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">likely_categorical</span>

<span class="k">def</span> <span class="nf">train_model</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="n">feature_model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                                       <span class="n">max_features</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                                       <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                                                       <span class="n">oob_score</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">12</span><span class="p">,)</span>
    <span class="n">feature_model</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">feature_model</span>
<span class="k">def</span> <span class="nf">plot_model_interpretations</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="n">explainer</span> <span class="o">=</span> <span class="n">shap</span><span class="p">.</span><span class="n">TreeExplainer</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="n">shap_values</span><span class="o">=</span><span class="n">explainer</span><span class="p">.</span><span class="n">shap_values</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">shap</span><span class="p">.</span><span class="n">summary_plot</span><span class="p">(</span><span class="n">shap_values</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">x</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">plot_partial_dependance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span><span class="n">model</span><span class="p">):</span>
    <span class="n">base_features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">pdp_dist</span> <span class="o">=</span> <span class="n">pdp</span><span class="p">.</span><span class="n">pdp_isolate</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">model_features</span><span class="o">=</span><span class="n">x</span><span class="p">.</span><span class="n">columns</span><span class="p">,</span>
                               <span class="n">feature</span><span class="o">=</span><span class="n">feature</span><span class="p">)</span>
    <span class="n">pdp</span><span class="p">.</span><span class="n">pdp_plot</span><span class="p">(</span><span class="n">pdp_dist</span><span class="p">,</span><span class="n">feature</span> <span class="p">,</span> <span class="n">plot_pts_dist</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
		
		
</code></pre></div></div>
<h2 id="load-the-data-and-clean-up">Load the data and clean up</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	
<span class="n">data_frame</span><span class="o">=</span><span class="n">pandas</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'heart_statlog_cleveland_hungary_final.csv'</span><span class="p">)</span>
<span class="n">categorical_columns</span><span class="o">=</span><span class="n">get_categorical_variables</span><span class="p">(</span><span class="n">data_frame</span><span class="p">)</span>
<span class="n">numerical_columns</span><span class="o">=</span><span class="p">[</span><span class="n">column</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">data_frame</span><span class="p">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">categorical_columns</span><span class="p">]</span>

<span class="c1"># remove outliers 
</span><span class="n">zscore</span> <span class="o">=</span> <span class="n">numpy</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">zscore</span><span class="p">(</span><span class="n">data_frame</span><span class="p">[</span><span class="n">numerical_columns</span><span class="p">]))</span>
<span class="n">data_frame_no_outliers</span> <span class="o">=</span> <span class="n">data_frame</span><span class="p">[(</span><span class="n">zscore</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">).</span><span class="nb">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)].</span><span class="n">copy</span><span class="p">()</span>
<span class="n">data_frame_no_categorical</span> <span class="o">=</span> <span class="n">pandas</span><span class="p">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">data_frame_no_outliers</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">feature_columns</span><span class="o">=</span><span class="p">[</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data_frame_no_categorical</span><span class="p">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">i</span><span class="o">!=</span><span class="s">'heart_disease'</span><span class="p">]</span>
<span class="n">x</span><span class="o">=</span><span class="n">data_frame_no_categorical</span><span class="p">[</span><span class="n">feature_columns</span><span class="p">].</span><span class="n">copy</span><span class="p">()</span>
<span class="n">y</span><span class="o">=</span><span class="n">data_frame_no_categorical</span><span class="p">.</span><span class="n">heart_disease</span><span class="p">.</span><span class="n">values</span>
<span class="n">model</span><span class="o">=</span><span class="n">train_model</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">plot_model_interpretations</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
		
</code></pre></div></div>

<h2 id="the-output-shap-values--and-partial-dependance-plot-for-cholesterol">The output (SHAP Values)  and partial dependance plot for Cholesterol</h2>
<p><img src="/assets/images/shap_initial_incorrect_values_heart_disease.jpg" alt="shap values heart disease" /></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_partial_dependance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="s">'cholesterol'</span><span class="p">,</span><span class="n">model</span><span class="p">)</span>
</code></pre></div></div>
<p><img src="/assets/images/partial_dependance_plot_for_cholesterol_incorrect.jpg" alt="Partial Dependance Plot, Cholesterol" /></p>

<p>This tells that, higher the cholesterol, lower the heart failure risk which is counter-intuitive. There is something wrong with the data. 
Let us do a scatterplot to analyse what is the distribution of cholesterol in the data</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">sns</span><span class="p">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s">'cholesterol'</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">'age'</span><span class="p">,</span> <span class="n">hue</span> <span class="o">=</span> <span class="s">'heart_disease'</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data_frame</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/assets/images/missing_cholesterol_scatterplot.jpg" alt="Missing Cholesterol Values, Scatterplot" /></p>

<p>Though there are multiple ways to impute, here let us try by training a regression model on known data.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cholesterol_train_frame</span><span class="o">=</span><span class="n">data_frame_no_categorical</span><span class="p">[</span><span class="n">data_frame_no_categorical</span><span class="p">[</span><span class="s">'cholesterol'</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">].</span><span class="n">copy</span><span class="p">()</span>
<span class="n">cholesterol_prediction</span><span class="o">=</span><span class="n">data_frame_no_categorical</span><span class="p">[</span><span class="n">data_frame_no_categorical</span><span class="p">[</span><span class="s">'cholesterol'</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">].</span><span class="n">copy</span><span class="p">()</span>
<span class="n">cholesterol_model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                                   <span class="n">max_features</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                                   <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                                                   <span class="n">oob_score</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">cholesterol_x</span><span class="o">=</span><span class="n">cholesterol_train_frame</span><span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="s">'cholesterol'</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">cholesterol_y</span><span class="o">=</span><span class="n">cholesterol_train_frame</span><span class="p">.</span><span class="n">cholesterol</span><span class="p">.</span><span class="n">values</span>
<span class="n">cholesterol_model</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cholesterol_x</span><span class="p">,</span> <span class="n">cholesterol_y</span><span class="p">)</span>
<span class="n">cholesterol_prediction</span><span class="p">[</span><span class="s">'cholesterol'</span><span class="p">]</span><span class="o">=</span><span class="n">cholesterol_model</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">cholesterol_prediction</span><span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="s">'cholesterol'</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="n">clean_frame</span><span class="o">=</span><span class="n">cholesterol_train_frame</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">cholesterol_prediction</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">sns</span><span class="p">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s">'cholesterol'</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">'age'</span><span class="p">,</span> <span class="n">hue</span> <span class="o">=</span> <span class="s">'heart_disease'</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">clean_frame</span><span class="p">)</span>

</code></pre></div></div>
<p><img src="/assets/images/cholesterol_scatterplot_clean.jpg" alt="Scatterplot for cholesterol, after clean up" /></p>

<h2 id="build-the-model-with-clean-cholesterol-features-and-plot">Build the model with clean Cholesterol features and plot</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="o">=</span><span class="n">clean_frame</span><span class="p">[</span><span class="n">feature_columns</span><span class="p">].</span><span class="n">copy</span><span class="p">()</span>
<span class="n">y</span><span class="o">=</span><span class="n">clean_frame</span><span class="p">.</span><span class="n">heart_disease</span><span class="p">.</span><span class="n">values</span>
<span class="n">model</span><span class="o">=</span><span class="n">train_model</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">plot_model_interpretations</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

</code></pre></div></div>

<p>Using the image with explanations for simplicity (in code, only output plot comes) 
<img src="/assets/images/shap_values_heart_data.jpg" alt="heart disease factors, shap plot" /></p>

<h2 id="partial-dependance-plot-for-continuous-variablesfactors">Partial Dependance Plot for continuous variables/factors</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">numerical_column</span> <span class="ow">in</span> <span class="n">numerical_columns</span><span class="p">:</span>
    <span class="n">plot_partial_dependance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">numerical_column</span><span class="p">,</span><span class="n">model</span><span class="p">)</span>
</code></pre></div></div>
<p><img src="/assets/images/continuous_features_plot1.jpg" alt="Heart disease partial dependance plot features 1" />
<img src="/assets/images/continuous_features_plot2.jpg" alt="Heart disease partial dependance plot features 2" /></p>

<p><strong>Acknowledgements</strong></p>

<p>The dataset is taken from three other research datasets used in different research papers. The Nature article listing heart disease database and names of popular datasets used in various heart disease research is shared below.
https://www.nature.com/articles/s41597-019-0206-3</p>

<p>The data set is consolidated and <a href="https://www.kaggle.com/sid321axn/heart-statlog-cleveland-hungary-final">made available in kaggle</a></p>

<p>Thanks to <a href="https://www.kaggle.com/sid321axn/stacked-ensemble-for-heart-disease-classification">this wonderful post in Kaggle</a> whch I have used in data cleanup</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/eda" class="page__taxonomy-item" rel="tag">EDA</a><span class="sep">, </span>
    
      
      
      <a href="/tags/ema" class="page__taxonomy-item" rel="tag">EMA</a><span class="sep">, </span>
    
      
      
      <a href="/tags/explainable-ai" class="page__taxonomy-item" rel="tag">explainable_ai</a><span class="sep">, </span>
    
      
      
      <a href="/tags/exploratory-model-analysis" class="page__taxonomy-item" rel="tag">exploratory_model_analysis</a><span class="sep">, </span>
    
      
      
      <a href="/tags/machine-learning" class="page__taxonomy-item" rel="tag">machine_learning</a><span class="sep">, </span>
    
      
      
      <a href="/tags/xai" class="page__taxonomy-item" rel="tag">xai</a>
    
    </span>
  </p>




        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-09-13T00:00:00+05:30">September 13, 2020</time></p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=sahyagiri&text=Exploratory+Model+Analysis+on+Heart+Disease+Data%20http%3A%2F%2Flocalhost%3A4000%2Fexploratory-model-analysis-on-heart-disease-data%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fexploratory-model-analysis-on-heart-disease-data%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fexploratory-model-analysis-on-heart-disease-data%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/how-to-reduce-heart-disease-risk-an-exploratory-model-analysis-on-open-data-set/" class="pagination--pager" title="How to reduce heart disease risk? An exploratory Model Analysis on open data set
">Previous</a>
    
    
      <a href="/are-we-progressing-as-human/" class="pagination--pager" title="Are we progressing as human?
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/prospects-and-nudges-how-human-behavior-influences-economics/" rel="permalink">Prospects and Nudges,  how human behavior influences economics
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Do you often
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/malayalam-transliterator-with-next-word-prediction/" rel="permalink">Malayalam Transliterator with next word prediction
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          less than 1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">മലയാളം എഴുത്ത് ഉപകരണ പരീക്ഷണം 
എല്ലാവർക്കും കേരള പിരവി ആശംസകൾ
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/teapot-simplifying-statistical-tests-with-a-click/" rel="permalink">Teapot: Simplifying statistical tests with a click
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          less than 1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">For beginners and non-programmers, getting statistical tests done could create headaches.  What if we only want to know if there is a relationship between on...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/bring-your-own-data/" rel="permalink">Bring your own data
</a>
      
    </h2>
    


    <p class="archive__item-excerpt" itemprop="description">One of the reasons of I love Software Engineering is  because, with right user experience; even a layman can start using any software tool.  When it comes to...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->
<div id="banner"></div>
    <script>
	// Set to the same value as the web property used on the site
		var gaProperty = 'UA-123456-1';

		// Disable tracking if the opt-out cookie exists.
		var disableStr = 'ga-disable-' + gaProperty;
		if (document.cookie.indexOf(disableStr + '=true') > -1) {
		  window[disableStr] = true;
		}

		// Opt-out function
		function gaOptOut() {
		  document.cookie = disableStr + '=true; expires=Thu, 31 Dec 2099 23:59:59 UTC; path=/';
		  window[disableStr] = true;
		  console.log('disabled google analytics')
		}
		// Opt-out function
		function gaOptIn() {
		  document.cookie = disableStr + '=false; expires=Thu, 31 Dec 2099 23:59:59 UTC; path=/';
		  window[disableStr] = false;
		  console.log('enabled google analytics')
		}
	
	
	  function googleAnalytics(){
		  console.log('initialized analytics') 
		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', 'UA-177574000-1']);
		  
		  _gaq.push(['_trackPageview']);

		  (function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		  })();
		}
      const options = {
 
			  cookieName: 'beyonk_gdpr',

			  cookieConfig: {
				domain: 'dossiers.page',
				path: '/'
			  },

			  heading: 'A note on cookies',
			  description: 'We use cookies to offer a better browsing experience, analyze site traffic, personalize content, and serve targeted advertisements. Please review our <a href="/privacy-policy">privacy policy page</a>. By clicking accept, you consent to our privacy policy & use of cookies.',
			  acceptLabel: 'Confirm all',
			  settingsLabel: 'Preferences',
			  closeLabel: 'Close window',

			  choices: {
				necessary: {
				  label: 'Required cookies',
				  description:
					"These can't be turned off as they are used to control all the other cookies",
				  value: true
				},
				analytics: {
				  label: 'Google Analytics',
				  description:
					"The site uses GA to understand the readers better",
				  value: true
				}
			  },

			  /**
			   * Show an icon to edit cookies later, when banner is closed.
			  **/
			  showEditIcon: true,

			  /**
			   * These are the functions which are run if a user opts-in to that category.
			   * You should drop your cookies here (or set a variable to control the later dropping of cookies.
			   *
			   * If you are using svelte, you can use events instead - see the Svelte section below.
			   **/
			  categories: {
				analytics: function() {
				},
				necessary: function() {
				  console.log('default-necessary cookies')
				  if (options['choices']['analytics']['value']){gaOptIn()}
				  else {gaOptOut()}
				}
			  }
			}
				
	
	
      GdprConsent.attachBanner(document.getElementById('banner'), options)
    </script>
<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
          <li><a href="https://instagram.com/sahyagiri/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i> Instagram</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 Gireesan Namboothiri. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




    
  <script>
    (function ($) {
    $('#new_comment').submit(function () {
      var form = this;

      $(form).addClass('disabled');
      $('#comment-form-submit').html('<i class="fas fa-spinner fa-spin fa-fw"></i> Loading...');

      $.ajax({
        type: $(this).attr('method'),
        url: $(this).attr('action'),
        data: $(this).serialize(),
        contentType: 'application/x-www-form-urlencoded',
        success: function (data) {
          $('#comment-form-submit').html('Submitted');
          $('.page__comments-form .js-notice').removeClass('notice--danger');
          $('.page__comments-form .js-notice').addClass('notice--success');
          showAlert('Thanks for your comment! It will show on the site once it has been approved.');
        },
        error: function (err) {
          console.log(err);
          $('#comment-form-submit').html('Submit comment');
          $('.page__comments-form .js-notice').removeClass('notice--success');
          $('.page__comments-form .js-notice').addClass('notice--danger');
          showAlert('Sorry, there was an error with your submission. Please make sure all required fields have been completed and try again.');
          $(form).removeClass('disabled');
        }
      });

      return false;
    });

    function showAlert(message) {
      $('.page__comments-form .js-notice').removeClass('hidden');
      $('.page__comments-form .js-notice-text').html(message);
    }
  })(jQuery);
  </script>


  





  </body>
</html>
